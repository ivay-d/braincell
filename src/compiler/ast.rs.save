use crate::types::{Tokens, Nodes};
use std::fmt::{Display, Formatter, Result};

#[derive(Clone)]
pub struct Ast {
  nodes: Vec<Nodes>,
}

impl Display for Ast {
  fn fmt(&self, f: &mut Formatter<'_>) -> Result {
    write!(f, "{:?}", self.nodes)
  }
}

impl Ast {
  pub fn new() -> Self {
    Self {
      nodes: Vec::new(),
    }
  }

  pub fn parse(&mut self, tokens: &Vec<Tokens>) -> &Vec<Nodes> {
    for word in tokens.iter() {
      if let Some(nodes) = match word {
        Tokens::Plus => match self.nodes.last() {
          None => Some(Nodes::Plus),
          Some(Nodes::Plus) => Some(Nodes::Pluses(2)),
          Some(Nodes::Pluses(value)) => Some(Nodes::Pluses(value + 1)),
          _ => Some(Nodes::Plus),
        },
        Tokens::Minus => match self.nodes.last() {
          None => Some(Nodes::Minus),
          Some(Nodes::Minus) => Some(Nodes::Minuses(2)),
          Some(Nodes::Minuses(value)) => Some(Nodes::Minuses(value + 1)),
          _ => Some(Nodes::Minus),
        },
        Tokens::Dot => match self.nodes.last() {
          None => Some(Nodes::Dot),
          Some(Nodes::Dot) => Some(Nodes::Dots(2)),
          Some(Nodes::Dots(value)) => Some(Nodes::Dots(value + 1)),
          _ => Some(Nodes::Dot),
        },
        Tokens::Comma => match self.nodes.last() {
          None => Some(Nodes::Comma),
          Some(Nodes::Comma) => Some(Nodez::Commas(2)),
          Some(Nodes::Comma(value)) => Some(Nodes::Commas(value + 1)),
          _ => Some(Nodes::Comma),
        },
        Tokens::MoveRight => match self.nodes.last() {
          None => Some(
        },
        Tokens::MoveLeft => match self.nodes.last() {
        },
        Tokens::OpenBracket => match self.nodes.last() {
        },
        Tokens::CloseBracket => match self.nodes.last() {
        },
        Tokens::Special(Char::Space) => Some(Nodes::Special(Char::Space)),
        _ => Some(Nodes::Unknown(word)),
      } {
        let index = self.nodes.len();
        if matches!(nodes, Nodes::Dots(_)) || matches!(nodes, Nodes::Pluses(_)) || matches!(nodes, Nodes::Minuses(_)) {
          self.nodes[index - 1] = nodes;
        } else {
          self.nodes.push(nodes);
        }
      }
    }
    &self.nodes
  }
}
